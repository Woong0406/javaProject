<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title th:text="${title}"></title>
  <script>
    function updateHref() {
      var currentUrl = window.location.href;
      var modify = document.getElementById("modify");
      var path = currentUrl.split('/');
      var postUUID = path[path.length - 1];

      if (modify) {
        modify.href = "/post/" + postUUID + "?modify=true";
      }
      var comment = document.getElementById("comment");
      if (comment) {
        comment.action = "/comment/" + postUUID;
      }
      var like = document.getElementById("like");
      if (like) {
        like.href = "/like/" + postUUID;
      }
    }
    function onDeleteClick() {
      var currentUrl = window.location.href;
      var path = currentUrl.split('/');
      var postUUID = path[path.length - 1];
      fetch('/post/' + postUUID, {
        method: 'DELETE'
      }).then(result => window.location.href = '/')

    }
  </script>
</head>
<body onload="updateHref()">
<h1 th:text="${title}"></h1>
<div th:utext="${content}"></div>
<p th:text="'글쓴이 : ' + ${writer}"></p>
<p th:text="'최근 수정일 : ' + ${modData}"></p>
<p th:text="'올린 날짜 : ' + ${regData}"></p>

<p th:text="'좋아요 : ' + ${likes}"></p>
<a id="like" th:if="${isLoginned}" th:text="${!isLiked} ? '좋아요' : '좋아요 취소'"></a>


<a id="modify" th:if="${isWriter}">수정하기</a>
<button onclick="onDeleteClick()" th:if="${isWriter}">삭제하기</button>
<h2>댓글</h2>
<table>
  <thead>
  <tr>
    <th>유저</th>
    <th>내용</th>
  </tr>
  </thead>
  <tbody>
  <tr th:each="comment : ${comments}" th:data-uuid="${comment.uuid}">
    <td th:text="${comment.writer}"></td>
    <td th:text="${comment.content}"></td>
    <td th:text="'최근 수정일 : ' + ${comment.modDate}"></td>
    <td th:text="'올린 날짜 : ' + ${comment.regDate}"></td>
  </tr>
  </tbody>
</table>
<div th:if="${isLoginned}">
  <h3>댓글 쓰기</h3>
  <form id="comment" method="post">
    <textarea name="content" rows="4" cols="50" placeholder="댓글을 입력하세요..."></textarea><br>
    <button type="submit">댓글 달기</button>
  </form>
</div>
</body>
</html>
